@model PROG7312_POE.Controllers.LocalEventsViewModel
@{
    ViewData["Title"] = "Local Events & Announcements";
}

<h2 class="mb-4">Local Events & Announcements</h2>

<form method="get" class="mb-4 row g-2 align-items-end">
    <div class="col-md-3">
        <label>Keyword</label>
        <input type="text" name="keyword" value="@Model.Keyword" class="form-control" placeholder="Search events..." />
    </div>

    <div class="col-md-3">
        <label>Category</label>
        <select name="category" class="form-select">
            <option value="">All</option>
            @foreach (var c in Model.Categories)
            {
                <option value="@c" selected="@(Model.SelectedCategory == c)">@c</option>
            }
        </select>
    </div>

    <div class="col-md-2">
        <label>Date</label>
        <input type="date" name="eventDate" value="@Model.SelectedDate?.ToString("yyyy-MM-dd")" class="form-control" />
    </div>

    <div class="col-md-2">
        <label>Sort by</label>
        <select name="sortOrder" class="form-select">
            <option value="">Date ↑</option>
            <option value="date_desc" selected="@(Model.SortOrder == "date_desc")">Date ↓</option>
            <option value="name" selected="@(Model.SortOrder == "name")">Name ↑</option>
            <option value="name_desc" selected="@(Model.SortOrder == "name_desc")">Name ↓</option>
            <option value="category" selected="@(Model.SortOrder == "category")">Category ↑</option>
            <option value="category_desc" selected="@(Model.SortOrder == "category_desc")">Category ↓</option>
        </select>
    </div>

    <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">Filter</button>
    </div>
</form>

@if (Model.Recommendations != null && Model.Recommendations.Any())
{
    <div class="alert alert-success mb-4">
        <h5>Recommended Events for You</h5>
        <ul class="mb-0">
            @foreach (var rec in Model.Recommendations)
            {
                <li><strong>@rec.Title</strong> — @rec.Category (@rec.Date.ToLocalTime().ToString("dd MMM yyyy"))</li>
            }
        </ul>
    </div>
}

@if (Model.Events == null || Model.Events.Count == 0)
{
    <div class="alert alert-info">
        <strong>No events found.</strong> Try adjusting your search, category, or date.
    </div>
}
else
{
    <div class="row row-cols-1 row-cols-md-2 g-4 mb-4">
        @foreach (var e in Model.Events)
        {
            <div class="col">
                <div class="card h-100 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">@e.Title</h5>
                        <p class="card-text">@e.Summary</p>
                    </div>
                    <div class="card-footer text-muted">
                        @e.Location | @e.Date.ToLocalTime().ToString("dd MMM yyyy")
                    </div>
                </div>
            </div>
        }
    </div>
}

@if (Model.Announcements != null && Model.Announcements.Any())
{
    <h3 class="mb-3">Announcements</h3>
    <div class="row row-cols-1 row-cols-md-2 g-3">
        @foreach (var a in Model.Announcements)
        {
            <div class="col">
                <div class="card h-100 border-info bg-light">
                    <div class="card-body">
                        <h6 class="card-title">@a.Title</h6>
                        <p class="card-text">@a.Body</p>
                    </div>
                    <div class="card-footer text-muted small">
                        Posted: @a.Posted.ToLocalTime().ToString("dd MMM yyyy")
                    </div>
                </div>
            </div>
        }
    </div>
}
